#!/bin/bash

set -e

shopt -s dotglob
SOURCE_DIR=/tmp/src

if [ ! -d "$SOURCE_DIR" ]; then
   echo "Error: Source volume not mounted or available"
   exit 1
fi

echo "---> Installing application source ..."
mv /tmp/src/* ./

echo "---> Building production release tarball ..."
rebar3 as prod tar

fix-permissions /opt/app-root
